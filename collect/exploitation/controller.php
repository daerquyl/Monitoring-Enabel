<?php
require_once($_SERVER['DOCUMENT_ROOT'].'/monitoring/collect/commons/other_collect_utils.php');
/*
* GESTIONNAIRE POUR PARAMETRAGE AVANT SAUVEGARDE
*/
function exploitation_ctrl_pre_save(&$collect){
	
	//Owner id
	$collect['owner_id'] = $collect['owner_name'].$collect['parcel_code'];
	
	//Is adult
	$collect['is_adult'] = $collect['age'] >= 35;

	//Net Revenue / Total Selled / Total Expenses
	$collect['total_planted_area'] = 0;
	
	$speculations_planted_areas = $collect['planted_area'];
	if($speculations_planted_areas != null){
		foreach($speculations_planted_areas as $planted_area){
			$collect['total_planted_area'] += $planted_area;
		}
	}
	
	$total_selled_amount = 0;
	$total_stock_amount = 0;
	$total_consumed_amount = 0;
	$total_lost_amount = 0;
	$total_other_amount = 0;
	
	$speculations_selled_amount_scs = $collect['selled_amount_with_contract'];
	if($speculations_selled_amount_scs != null){
		foreach($speculations_selled_amount_scs as $selled_amount_sc){
			$total_selled_amount += $selled_amount_sc;
		}
	}
	
	$speculations_selled_amount_hcs = $collect['selled_amount_without_contract'];
	if($speculations_selled_amount_hcs != null){
		foreach($speculations_selled_amount_hcs as $selled_amount_hc){
			$total_selled_amount += $selled_amount_hc;
		}
	}
	
	$speculations_stock_amount = $collect['stock_value'];
	if($speculations_stock_amount != null){
		foreach($speculations_stock_amount as $stock_amount){
			$total_stock_amount += $stock_amount;
		}
	}
	
	$speculations_consumed_amount = $collect['consumed_value'];
	if($speculations_consumed_amount != null){
		foreach($speculations_consumed_amount as $consumed_amount){
			$total_consumed_amount += $consumed_amount;
		}
	}
	
	$speculations_lost_amount = $collect['lost_value'];
	if($speculations_lost_amount != null){
		foreach($speculations_lost_amount as $lost_amount){
			$total_lost_amount += $lost_amount;
		}
	}
	
	$speculations_other_amount = $collect['other_revenues'];
	if($speculations_other_amount != null){
		foreach($speculations_other_amount as $other_amount){
			$total_other_amount += $other_amount;
		}
	}
		
	$collect['fetilizer_cost'] = $collect['organic_fertilizer_cost'] + $collect['mineral_fertilizer_cost'];	
	
	$total_salary_expenses = 0;
	$employees_revenue = $collect['employee_revenue'];
	if($employees_revenue != null){
		foreach($employees_revenue as $employee_revenue){
			if(!empty($employee_revenue)){
				$total_salary_expenses += $employee_revenue;
			}
		}
	}
	$collect['salary_payed'] = $total_salary_expenses;
	
	$collect['total_expenses'] = $collect['fetilizer_cost'] + $collect['seeds_amount']
								+ $collect['soil_preparation_amount'] + $collect['phytosanitizer_cost']
								+ $collect['agricultural_equipment_cost'] + $collect['agricultural_equipment_maintenance_cost']
								+ $collect['irrigation_network_cost'] + $collect['royalties_payed']
								+ $collect['salary_payed'] + $collect['credit_repayment_amount']
								+ $collect['cooperative_contribution_amount'] + $collect['other_amount'];
								
	$collect['total_selled_amount'] =  $total_selled_amount + $total_other_amount ;

	$collect['manager_revenue'] = $collect['total_selled_amount'] + $total_stock_amount + $total_consumed_amount;
	
	$collect['net_revenue'] = $collect['manager_revenue'] - $collect['total_expenses'];
	
	
	//Total employes par mode de remuneration
	$collect['total_mensual_salary'] = 0 /* A CALCULER */;
	$collect['total_timed_salary'] = 0 /* A CALCULER */;
	$collect['total_campaign_salary'] = 0 /* A CALCULER */;
	$employee_payment_modes = $collect['payment_mode'];
	if($employee_payment_modes != null){
		foreach($employee_payment_modes as $employee_payment_mode){
			if($employee_payment_mode == "Mois"){
				$collect['total_mensual_salary']++;
			}
			if($employee_payment_mode == "Jour" || $employee_payment_mode == "Tache"){
				$collect['total_timed_salary']++;
			}
			if($employee_payment_mode == "Campagne"){
				$collect['total_campaign_salary']++;
			}
		}
	}

	//ETP
/*	$collect['etp_permanent_men_lt35'] = getETP('Journalier', 'H', false, $collect);
	$collect['etp_permanent_men_gt35'] = getETP('Journalier', 'H', true, $collect);
	$collect['etp_permanent_women_lt35'] = getETP('Journalier', 'F', false, $collect);
	$collect['etp_permanent_women_gt35'] = getETP('Journalier', 'F', true, $collect);
	$collect['etp_temporary_men_lt35'] = getETP('Saisonnier', 'H', false, $collect);
	$collect['etp_temporary_men_gt35'] = getETP('Saisonnier', 'H', true, $collect);
	$collect['etp_temporary_women_lt35'] = getETP('Saisonnier', 'F', false, $collect);
	$collect['etp_temporary_women_gt35'] = getETP('Saisonnier', 'F', true, $collect);*/

}						